# Bitmonbot - Changelog

[0.5.0] - 2025-05-21
Виправлено критичні проблеми

ВИПРАВЛЕНО: Telegram Worker не відповідав на команди користувачів через неповну реалізацію методу handle_commands()
ВИПРАВЛЕНО: Відсутність реального опитування Telegram API для отримання оновлень від користувачів
ВИПРАВЛЕНО: Дублююча директива [Service] у файлі systemd сервісу bitmonbot.service
ВИПРАВЛЕНО: Логи Telegram компонента не оновлювалися з 13 травня до 21 травня

Додано нові компоненти

НОВИЙ МОДУЛЬ: telegram_watchdog.py - автоматичний моніторинг та перезапуск Telegram компонента
НОВИЙ СЕРВІС: Systemd сервіс bitmonbot-watchdog.service для автоматичного запуску watchdog
НОВИЙ СКРИПТ: test_telegram.py - утиліта для тестування Telegram API та функціональності бота
НОВА ФУНКЦІЯ: Автоматична перевірка стану Telegram компонента кожні 5 хвилин через health_check()

Покращено архітектуру

ВДОСКОНАЛЕНО: Повністю переписаний метод handle_commands() в telegram_worker.py з реальним опитуванням Telegram API
ВДОСКОНАЛЕНО: Додано метод _process_update() для обробки оновлень від Telegram
ВДОСКОНАЛЕНО: Реалізовано всі обробники команд: /start, /help, /status, /pairs, /threshold
ВДОСКОНАЛЕНО: Додано підтримку callback query для інлайн-кнопок
ВДОСКОНАЛЕНО: Покращена обробка помилок та відновлення HTTP-сесій

Додано системні сервіси

НАЛАШТОВАНО: Systemd сервіс bitmonbot.service для автоматичного запуску основного бота
НАЛАШТОВАНО: Systemd сервіс bitmonbot-watchdog.service для моніторингу стану бота
НАЛАШТОВАНО: Автоматичний перезапуск сервісів при падінні з затримкою 10-30 секунд
НАЛАШТОВАНО: Журналювання через systemd journal з ідентифікаторами bitmonbot та bitmonbot-watchdog

Додано моніторинг та діагностику

НОВИЙ ФАЙЛ: /root/bitmonbot/status/telegram_status.json - статус Telegram Worker
НОВИЙ ЛОГ: /root/bitmonbot/logs/telegram_watchdog.log - логи watchdog системи
НОВИЙ ЛОГ: /root/bitmonbot/logs/telegram_test.log - логи тестових перевірок
НОВА ФУНКЦІЯ: Автоматичне сповіщення адміністраторів при виявленні проблем

Автоматизація через Cron

НАЛАШТОВАНО: Crontab завдання для тестування Telegram API кожну годину
НАЛАSHTОВАНО: Crontab завдання для запуску watchdog кожні 2 години
ОПТИМІЗОВАНО: Зменшено частоту тестових повідомлень з кожних 15 хвилин до кожної години

Технічні покращення

ДОДАНО: Метод check_telegram_api() для перевірки з'єднання з Telegram API
ДОДАНО: Метод check_telegram_logs() для аналізу активності в логах
ДОДАНО: Метод check_telegram_status_file() для перевірки файлів статусу
ДОДАНО: Автоматичне перезапуск бота з максимум 3 спробами при виявленні проблем
ДОДАНО: Graceful shutdown з SIGTERM перед примусовим SIGKILL

Покращена стабільність

ПОКРАЩЕНО: HTTP-сесії автоматично відновлюються при помилках
ПОКРАЩЕНО: Обробка помилок з повторними спробами та експоненціальною затримкою
ПОКРАЩЕНО: Логування з детальною діагностичною інформацією
ПОКРАЩЕНО: Керування життєвим циклом асинхронних задач

Адміністративні команди

РЕАЛІЗОВАНО: /approve - схвалення користувачів (тільки для адміністраторів)
РЕАЛІЗОВАНО: /block - блокування користувачів (тільки для адміністраторів)
РЕАЛІЗОВАНО: /users - перегляд статистики користувачів (тільки для адміністраторів)
ПОКРАЩЕНО: Автоматичне сповіщення адміністраторів про нових користувачів

Файли конфігурації

ВИПРАВЛЕНО: /etc/systemd/system/bitmonbot.service - видалено дублюючу директиву [Service]
СТВОРЕНО: /etc/systemd/system/bitmonbot-watchdog.service - новий systemd сервіс
ОНОВЛЕНО: Crontab для користувача root з оптимізованою частотою перевірок

Утиліти та скрипти

test_telegram.py - комплексне тестування Telegram API
telegram_watchdog.py - автоматичний моніторинг та перезапуск
Cron завдання - регулярні перевірки стану системи

Результат
Після впровадження цих змін:

✅ Бот стабільно відповідає на команди в Telegram
✅ Автоматичний перезапуск при проблемах
✅ Детальний моніторинг стану всіх компонентів
✅ Сповіщення адміністраторів про проблеми
✅ Зменшено частоту тестових повідомлень
✅ Покращена загальна стабільність системи

## [0.4.0] - 2025-05-15

### Додано
- Управління користувачами та їх підписками на певні пари
- Аналіз історичних даних для виявлення найприбутковіших пар
- Система сповіщень з персоналізованими налаштуваннями для користувачів
- Розширені можливості фільтрації за мінімальним рівнем прибутку
- Оптимізована робота з API бірж для зменшення навантаження
- Утиліти для аналізу та візуалізації знайдених можливостей

## [0.3.1] - 2025-05-05

### Додано
- Реалізовано метод `check_order_book_depth` для всіх бірж для оцінки ліквідності
- Додано розрахунок прослизання для більш точної оцінки можливості виконання угод
- Додано налаштування `MAX_ACCEPTABLE_SLIPPAGE` для визначення прийнятного рівня прослизання
- Оптимізовано аналіз ордербуків для великих обсягів угод

### Покращено
- Удосконалено логіку оцінки арбітражних можливостей з урахуванням ліквідності
- Реалізовано детальне логування аналізу глибини ордербуку
- Додано інформативні повідомлення про недостатню ліквідність ринку

## [0.3.0] - 2025-05-02

### Додано
- Реалізовано пошук трикутних арбітражних можливостей на одній біржі
- Створено модуль для аналізу найприбутковіших пар та шляхів
- Додано розрахунок комісій для оцінки чистого прибутку
- Реалізовано веб-інтерфейс для моніторингу статусу та статистики
- Оптимізовано роботу в різні години доби для кращого використання ресурсів
- Додано Telegram-команди для керування та отримання статистики

### Покращено
- Вдосконалено формат Telegram-повідомлень про арбітражні можливості
- Додано емодзі для покращення читабельності повідомлень
- Додано динамічне відображення емодзі в залежності від розміру прибутку
- Покращено візуальну структуру повідомлень з кращим форматуванням

## [0.2.0] - 2025-05-01

### Додано
- Режим тестування для симуляції арбітражних можливостей
- Розширене логування цін для кращого аналізу
- Моніторинг стану черги Telegram-повідомлень
- Періодичне надсилання статусу бота в Telegram
- Зберігання детальної статистики роботи в JSON-файли
- Опція для налаштування інтервалу моніторингу черги
- Лічильники успішних та невдалих відправок повідомлень

### Покращено
- Обробка помилок при взаємодії з біржами
- Повторні спроби при помилках надсилання Telegram-повідомлень
- Логування часу виконання операцій для кращої діагностики
- Обмеження швидкості для уникнення блокування Telegram API
- Процес завершення роботи з коректним звільненням ресурсів
- Збереження окремих файлів для повного та короткого статусу

### Виправлено
- Обробка незакритих HTTP-сесій при завершенні роботи
- Обробка випадків, коли дані від бірж відсутні або неповні
- Обробка потенційних помилок при форматуванні повідомлень

## [0.1.0] - 2025-04-30

### Створено
- Розроблено базову структуру проєкту з модульною архітектурою
- Налаштовано систему керування конфігурацією через `.env` файли
- Створено реалізацію модуля для роботи з API криптовалютних бірж
  - Базовий абстрактний клас `BaseExchange`
  - Реалізація для Binance, KuCoin, Kraken
  - Фабрика для створення об'єктів бірж
- Реалізовано модуль для знаходження арбітражних можливостей
  - Клас для представлення арбітражної можливості
  - Логіка розрахунку потенційного прибутку
  - Асинхронний збір даних з різних бірж
- Реалізовано асинхронний модуль для сповіщень через Telegram
  - Базовий абстрактний клас нотифікатора
  - Telegram нотифікатор з підтримкою чергування повідомлень
  - Воркер для обробки черги повідомлень
- Створено детальну систему логування
  - Розділення логів за компонентами
  - Додатковий файл для debug логів
  - Консольне логування важливих подій
- Розроблено тестову утиліту для перевірки функціональності
